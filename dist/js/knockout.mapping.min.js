!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.mapping={})}(function(a,b){function c(){for(var a,b,c,d=arguments,e=d.length,f={},g=[];e--;)for(c=d[e],a=c.length;a--;)b=c[a],f[b]||(f[b]=1,g.push(b));return g}function d(a,e){var f;for(var g in e)if(e.hasOwnProperty(g)&&e[g])if(f=b.getType(a[g]),g&&a[g]&&"array"!==f&&"string"!==f)d(a[g],e[g]);else{var h="array"===b.getType(a[g])&&"array"===b.getType(e[g]);h?a[g]=c(a[g],e[g]):a[g]=e[g]}}function e(a,b){var c={};return d(c,a),d(c,b),c}function f(a,b){for(var c=e({},a),d=y.length-1;d>=0;d--){var f=y[d];c[f]&&(c[""]instanceof Object||(c[""]={}),c[""][f]=c[f],delete c[f])}return b&&(c.ignore=g(b.ignore,c.ignore),c.include=g(b.include,c.include),c.copy=g(b.copy,c.copy),c.observe=g(b.observe,c.observe)),c.ignore=g(c.ignore,B.ignore),c.include=g(c.include,B.include),c.copy=g(c.copy,B.copy),c.observe=g(c.observe,B.observe),c.mappedProperties=c.mappedProperties||{},c.copiedProperties=c.copiedProperties||{},c}function g(c,d){return"array"!==b.getType(c)&&(c="undefined"===b.getType(c)?[]:[c]),"array"!==b.getType(d)&&(d="undefined"===b.getType(d)?[]:[d]),a.utils.arrayGetDistinctValues(c.concat(d))}function h(b,c){var d=a.dependentObservable;a.dependentObservable=function(c,d,e){e=e||{},c&&"object"==typeof c&&(e=c);var f=e.deferEvaluation,g=!1,h=function(c){var d=a.dependentObservable;a.dependentObservable=w;var e=a.isWriteableObservable(c);a.dependentObservable=d;var f=w({read:function(){return g||(a.utils.arrayRemoveItem(b,c),g=!0),c.apply(c,arguments)},write:e&&function(a){return c(a)},deferEvaluation:!0});return u&&(f._wrapper=!0),f.__DO=c,f};e.deferEvaluation=!0;var i=new w(c,d,e);return f||(i=h(i),b.push(i)),i},a.dependentObservable.fn=w.fn,a.computed=a.dependentObservable;var e=c();return a.dependentObservable=d,a.computed=a.dependentObservable,e}function i(c,d,f,g,k,p,q){var r="array"===b.getType(a.utils.unwrapObservable(d));if(p=p||"",b.isMapped(c)){var u=a.utils.unwrapObservable(c)[v];f=e(u,f)}var w={data:d,parent:q||k},x=function(){return f[g]&&f[g].create instanceof Function},y=function(b){return h(s,function(){return a.utils.unwrapObservable(k)instanceof Array?f[g].create({data:b||w.data,parent:w.parent,skip:z}):f[g].create({data:b||w.data,parent:w.parent})})},A=function(){return f[g]&&f[g].update instanceof Function},B=function(b,c){var d={data:c||w.data,parent:w.parent,target:a.utils.unwrapObservable(b)};return a.isWriteableObservable(b)&&(d.observable=b),f[g].update(d)},C=t.get(d);if(C)return C;if(g=g||"",r){var D=[],E=!1,F=function(a){return a};f[g]&&f[g].key&&(F=f[g].key,E=!0),a.isObservable(c)||(c=a.observableArray([]),c.mappedRemove=function(a){var b="function"==typeof a?a:function(b){return b===F(a)};return c.remove(function(a){return b(F(a))})},c.mappedRemoveAll=function(b){var d=m(b,F);return c.remove(function(b){return-1!=a.utils.arrayIndexOf(d,F(b))})},c.mappedDestroy=function(a){var b="function"==typeof a?a:function(b){return b===F(a)};return c.destroy(function(a){return b(F(a))})},c.mappedDestroyAll=function(b){var d=m(b,F);return c.destroy(function(b){return-1!=a.utils.arrayIndexOf(d,F(b))})},c.mappedIndexOf=function(b){var d=m(c(),F),e=F(b);return a.utils.arrayIndexOf(d,e)},c.mappedGet=function(a){return c()[c.mappedIndexOf(a)]},c.mappedCreate=function(b){if(-1!==c.mappedIndexOf(b))throw new Error("There already is an object with the key that you specified.");var d=x()?y(b):b;if(A()){var e=B(d,b);a.isWriteableObservable(d)?d(e):d=e}return c.push(d),d});var G=m(a.utils.unwrapObservable(c),F).sort(),H=m(d,F);E&&H.sort();var I,J,K=a.utils.compareArrays(G,H),L={},M=a.utils.unwrapObservable(d),N={},O=!0;for(I=0,J=M.length;J>I;I++){var P=F(M[I]);if(void 0===P||P instanceof Object){O=!1;break}N[P]=M[I]}var Q=[],R=0;for(I=0,J=K.length;J>I;I++){var S,P=K[I],T=p+"["+I+"]";switch(P.status){case"added":var U=O?N[P.value]:l(a.utils.unwrapObservable(d),P.value,F);S=i(void 0,U,f,g,c,T,k),x()||(S=a.utils.unwrapObservable(S));var V=j(a.utils.unwrapObservable(d),U,L);S===z?R++:Q[V-R]=S,L[V]=!0;break;case"retained":var U=O?N[P.value]:l(a.utils.unwrapObservable(d),P.value,F);S=l(c,P.value,F),i(S,U,f,g,c,T,k);var V=j(a.utils.unwrapObservable(d),U,L);Q[V]=S,L[V]=!0;break;case"deleted":S=l(c,P.value,F)}D.push({event:P.status,item:S})}c(Q),f[g]&&f[g].arrayChanged&&a.utils.arrayForEach(D,function(a){f[g].arrayChanged(a.event,a.item)})}else if(o(d)){if(c=a.utils.unwrapObservable(c),!c){if(x()){var W=y();return A()&&(W=B(W)),W}if(A())return B(W);c={}}if(A()&&(c=B(c)),t.save(d,c),A())return c;n(d,function(b){var e=p.length?p+"."+b:b;if(-1==a.utils.arrayIndexOf(f.ignore,e)){if(-1!=a.utils.arrayIndexOf(f.copy,e))return void(c[b]=d[b]);if("object"!=typeof d[b]&&"array"!=typeof d[b]&&f.observe.length>0&&-1==a.utils.arrayIndexOf(f.observe,e))return c[b]=d[b],void(f.copiedProperties[e]=!0);var g=t.get(d[b]),h=i(c[b],d[b],f,b,c,e,c),j=g||h;if(f.observe.length>0&&-1==a.utils.arrayIndexOf(f.observe,e))return c[b]=a.utils.unwrapObservable(j),void(f.copiedProperties[e]=!0);a.isWriteableObservable(c[b])?(j=a.utils.unwrapObservable(j),c[b]()!==j&&c[b](j)):(j=void 0===c[b]?j:a.utils.unwrapObservable(j),c[b]=j),f.mappedProperties[e]=!0}})}else switch(b.getType(d)){case"function":A()?a.isWriteableObservable(d)?(d(B(d)),c=d):c=B(d):c=d;break;default:if(a.isWriteableObservable(c)){if(A()){var X=B(c);return c(X),X}var X=a.utils.unwrapObservable(d);return c(X),X}var Y=x()||A();if(c=x()?y():a.observable(a.utils.unwrapObservable(d)),A()&&c(B(c)),Y)return c}return c}function j(a,b,c){for(var d=0,e=a.length;e>d;d++)if(c[d]!==!0&&a[d]===b)return d;return null}function k(c,d){var e;return d&&(e=d(c)),"undefined"===b.getType(e)&&(e=c),a.utils.unwrapObservable(e)}function l(b,c,d){b=a.utils.unwrapObservable(b);for(var e=0,f=b.length;f>e;e++){var g=b[e];if(k(g,d)===c)return g}throw new Error("When calling ko.update*, the key '"+c+"' was not found!")}function m(b,c){return a.utils.arrayMap(a.utils.unwrapObservable(b),function(a){return c?k(a,c):a})}function n(a,c){if("array"===b.getType(a))for(var d=0;d<a.length;d++)c(d);else for(var e in a)c(e)}function o(a){var c=b.getType(a);return("object"===c||"array"===c)&&null!==a}function p(a,c,d){var e=a||"";return"array"===b.getType(c)?a&&(e+="["+d+"]"):(a&&(e+="."),e+=d),e}function q(){var b=[],c=[];this.save=function(d,e){var f=a.utils.arrayIndexOf(b,d);f>=0?c[f]=e:(b.push(d),c.push(e))},this.get=function(d){var e=a.utils.arrayIndexOf(b,d),f=e>=0?c[e]:void 0;return f}}function r(){var a={},b=function(b){var c;try{c=b}catch(d){c="$$$"}var e=a[c];return void 0===e&&(e=new q,a[c]=e),e};this.save=function(a,c){b(a).save(a,c)},this.get=function(a){return b(a).get(a)}}var s,t,u=!0,v="__ko_mapping__",w=a.dependentObservable,x=0,y=["create","update","key","arrayChanged"],z={},A={include:["_destroy"],ignore:[],copy:[],observe:[]},B=A;b.isMapped=function(b){var c=a.utils.unwrapObservable(b);return c&&c[v]},b.fromJS=function(a){if(0==arguments.length)throw new Error("When calling ko.fromJS, pass the object you want to convert.");try{x++||(s=[],t=new r);var b,c;2==arguments.length&&(arguments[1][v]?c=arguments[1]:b=arguments[1]),3==arguments.length&&(b=arguments[1],c=arguments[2]),c&&(b=e(b,c[v])),b=f(b);var d=i(c,a,b);if(c&&(d=c),!--x)for(;s.length;){var g=s.pop();g&&(g(),g.__DO.throttleEvaluation=g.throttleEvaluation)}return d[v]=e(d[v],b),d}catch(h){throw x=0,h}},b.fromJSON=function(c){var d=a.utils.parseJson(c);return arguments[0]=d,b.fromJS.apply(this,arguments)},b.updateFromJS=function(a){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},b.updateFromJSON=function(a){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},b.toJS=function(c,d){if(B||b.resetDefaultOptions(),0==arguments.length)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==b.getType(B.ignore))throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==b.getType(B.include))throw new Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==b.getType(B.copy))throw new Error("ko.mapping.defaultOptions().copy should be an array.");return d=f(d,c[v]),b.visitModel(c,function(b){return a.utils.unwrapObservable(b)},d)},b.toJSON=function(c,d){var e=b.toJS(c,d);return a.utils.stringifyJson(e)},b.defaultOptions=function(){return arguments.length>0?void(B=arguments[0]):B},b.resetDefaultOptions=function(){B={include:A.include.slice(0),ignore:A.ignore.slice(0),copy:A.copy.slice(0),observe:A.observe.slice(0)}},b.getType=function(a){if(a&&"object"==typeof a){if(a.constructor===Date)return"date";if(a.constructor===Array)return"array"}return typeof a},b.visitModel=function(c,d,e){e=e||{},e.visitedObjects=e.visitedObjects||new r;var g,h=a.utils.unwrapObservable(c);if(!o(h))return d(c,e.parentName);e=f(e,h[v]),d(c,e.parentName),g="array"===b.getType(h)?[]:{},e.visitedObjects.save(c,g);var i=e.parentName;return n(h,function(c){if(!e.ignore||-1==a.utils.arrayIndexOf(e.ignore,c)){var f=h[c];if(e.parentName=p(i,h,c),-1!==a.utils.arrayIndexOf(e.copy,c)||-1!==a.utils.arrayIndexOf(e.include,c)||!h[v]||!h[v].mappedProperties||h[v].mappedProperties[c]||!h[v].copiedProperties||h[v].copiedProperties[c]||"array"===b.getType(h)){switch(b.getType(a.utils.unwrapObservable(f))){case"object":case"array":case"undefined":var j=e.visitedObjects.get(f);g[c]="undefined"!==b.getType(j)?j:b.visitModel(f,d,e);break;default:g[c]=d(f,e.parentName)}}}}),g}});