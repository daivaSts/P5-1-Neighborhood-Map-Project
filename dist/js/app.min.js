$(function(){"use strict";app()});var app=function(){"use strict";function a(a,b){var c,d,e,f,g,h,i,j,k=a.placeName(),l=(a.weather(),a.id()),m=(a.dt(),a.cityId()),n=setTimeout(function(){console.log("failed to get weather resources")},8e3),o="http://api.openweathermap.org/data/2.5/weather?id="+m+"&units=Imperial&APPID=ff982803bc4c98cca0de6f7c93d7e598";return $.ajax({url:o,dataType:"jsonp",success:function(m){void 0===m.snow?e="<p>Snow Accumulation: 0 </p>":(d=Math.floor(m.snowData["1h"]),e="<p>Snow: "+d+"mm for the last hour</p>"),j=m.dt,f="<p>Low: "+Math.floor(m.main.temp_min)+"F</p>",g="<p>Hi: "+Math.floor(m.main.temp_max)+"F</p>",h="img/"+m.weather[0].icon+".png",i=m.weather[0].description.charAt(0).toUpperCase()+m.weather[0].description.slice(1),c="<div><b>"+k+"</b></div><img src="+h+">"+i+"</div><div>"+g+f+e+"</div>",b.setContent(c),a.weather(c),a.dt(j),localStorage.setItem(k,c),localStorage.setItem(l,j),clearTimeout(n)},error:function(a,d,e){c="<div><b>Sorry! Weather data failed to load</b></div>",b.setContent(c),alert(e)}})}function b(a){var b=setTimeout(function(){console.log("failed to get wikipedia resources")},8e3),c="http://en.wikipedia.org/w/api.php?&action=opensearch&format=json&search="+a+"&namespace=0";return $.ajax({url:c,dataType:"jsonp",success:function(a){clearTimeout(b)},error:function(a,b,c){contentString="<div><b>Sorry! Wikipedia data failed to load</b></div>",infowindow.setContent(contentString),alert(c)}})}var c,d=[{placeName:"Telluride Ski Resort",lat:37.936389,lon:-107.820278,id:"1",cityId:5441199},{placeName:"Snowmass (ski area)",lat:39.1956,lon:-106.9513,id:"2",cityId:5439284},{placeName:"Aspen Mountain (ski area)",lat:39.641667,lon:-105.871667,id:"3",cityId:5412230},{placeName:"Breckenridge Ski Resort",lat:39.48,lon:-106.067,id:"4",cityId:4378291},{placeName:"Steamboat Ski Resort",lat:40.452778,lon:-106.773056,id:"5",cityId:5582371},{placeName:"Wolf Creek ski area",lat:37.472222,lon:-106.793333,id:"6",cityId:5785035},{placeName:"Eldora Mountain Resort",lat:39.9375,lon:-105.583611,id:"7",cityId:4855218},{placeName:"Powderhorn Resort",lat:39.063056,lon:-108.155556,id:"8",cityId:5435240}],e=function(){var a=864e5,b=new Date,c=new Date(b),d=new Date(2015,12,22),e=Math.round(Math.abs((c.getTime()-d.getTime())/a));return e},f=function(a){this.placeName=ko.observable(a.placeName),this.lat=ko.observable(a.lat),this.lon=ko.observable(a.lon),this.id=ko.observable(a.id),this.href=ko.computed(function(){return"#"+this.id()},this),this.wiki=ko.observable(""),this.weather=ko.observable(""),this.cityId=ko.observable(a.cityId),this.marker=ko.observable(""),this.dt=ko.observable(0)},g=function(){var a=this;a.resortList=ko.observableArray([]),d.forEach(function(b){a.resortList.push(new f(b))}),a.mappedArray=ko.mapping.fromJS(a.resortList()),a.currentPlace=ko.observable(this.resortList()[0]),a.placeSearch=ko.observable(""),a.filteredRecords=ko.computed(function(){return ko.utils.arrayFilter(a.mappedArray(),function(b){return 0==a.placeSearch().length||-1!=b.placeName().toLowerCase().search(a.placeSearch().toLowerCase())})}),a.filteredMarkers=ko.computed(function(){return ko.utils.arrayFilter(a.mappedArray(),function(b){return b.marker()?(b.marker().setVisible(!0),b.marker().icon="img/skiing-brown2.png",-1===b.marker().title.toLowerCase().search(a.placeSearch().toLowerCase())):void 0})}),a.setMarkersInvisible=ko.computed(function(){for(var b in a.filteredMarkers())a.filteredMarkers()[b].marker().infowindow.close(),a.filteredMarkers()[b].marker().setVisible(!1)}),a.days=ko.observable(e()),this.getWikiInfo=function(){a.currentPlace(this),this.wiki().length<=1&&b(this.placeName()).done(c)};var c=function(b){for(var c=0;c<b[1].length;c++){var d='<li class="article"><p>'+b[2][c]+'</p></li><a href="'+b[3][c]+'">Read more in Wikipedia</a>';a.currentPlace().wiki(b[2][c]);var e="#"+a.currentPlace().id();$(e).append(d)}}};ko.bindingHandlers.mymap={init:function(b,d){c=new google.maps.Map(document.getElementById("map"),{zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_CENTER},disableDefaultUI:!0,zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP});var e=new google.maps.LatLng(38,-111),f=new google.maps.LatLng(40.5,-104),g=new google.maps.LatLngBounds(e,f);c.fitBounds(g);var h=ko.utils.unwrapObservable(d()),i=["img/skiing-white2.png","img/skiing-brown2.png"],j="<div><p>Loading...</p></div>";h.forEach(function(b){var d=new google.maps.Marker({position:{lat:b.lat(),lng:b.lon()},title:b.placeName(),map:c,visible:!0,icon:i[1],infowindow:new google.maps.InfoWindow({maxWidth:400,content:j,opened:!1})});b.marker(d);var e=b.marker().infowindow,f=b.weather(),d=b.marker(),g=b.id(),k=document.getElementsByClassName("panel-info"),l=k[g-1],m="<div><b>Sorry! Weather data failed to load</b></div>";google.maps.event.addListener(d,"click",function(){e.opened===!0&&d.icon===i[0]?(e.close(),e.opened=!1,d.setIcon(i[1])):(h.forEach(function(a){a.marker().infowindow.opened&&(a.marker().infowindow.close(),a.marker().infowindow.opened=!1,a.marker().setIcon(i[1]))}),f===m||0===f.length?a(b,e):localStorage.getItem(b.placeName())?Math.floor((Date.now()/1e3-localStorage.getItem(b.id()))/360)>60?a(b,e):e.setContent(f):a(b,e),c.panTo(d.getPosition()),e.open(c,this),d.setIcon(i[0]),e.opened=!0)}),google.maps.event.addDomListener(l,"click",function(d){var g=0;return function(){g++,h.forEach(function(a){a.marker().infowindow.opened&&(a.marker().infowindow.close(),a.marker().infowindow.opened=!1,a.marker().setIcon(i[1]))}),e.opened===!1&&g%2!=0&&(f===m||0===f.length?a(b,e):localStorage.getItem(b.placeName())?Math.floor((Date.now()/1e3-localStorage.getItem(b.id()))/360)>60?a(b,e):e.setContent(f):a(b,e),c.panTo(d.getPosition()),e.open(c,d),d.setIcon(i[0]),e.opened=!0)}}(d)),google.maps.event.addListener(e,"domready",function(){$(".gm-style-iw").next("div").hide()})})}},ko.applyBindings(new g)};